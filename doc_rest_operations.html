




 

 
 
 

     <!doctype html>
<!--
 Generated by Apache Maven Doxia  at 2019-09-04  Rendered using Reflow Maven Skin 2.0.0-beta2 (http://devacfr.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">
                                                                    
                    <head>
    <meta charset="UTF-8" />
    <title>RESTful Operations - HAPI FHIR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="James Agnew" />
      <meta http-equiv="content-language" content="en" />
                                                        <link href="https://netdna.bootstrapcdn.com/bootswatch/4.1.3/lumen/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link href="./css/docs.css" rel="stylesheet" />
    <link href="./css/reflow-skin.css" rel="stylesheet" />

    <link href="./css/lightbox.css" rel="stylesheet" />
    <link href="./css/site.css" rel="stylesheet" />
    <link href="./css/print.css" rel="stylesheet" media="print" />
<!-- Syntax Highlighter -->
			<script type="text/javascript" src="syntaxhighlighter/shCore.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushJScript.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushJava.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushBash.js"></script>
			<script type="text/javascript" src="syntaxhighlighter/shBrushXml.js"></script>
			
			<link href="syntaxhighlighter/shCore.css" rel="stylesheet" type="text/css" />
			<link href="syntaxhighlighter/shThemeDefault.css" rel="stylesheet" type="text/css" />
			
			<!-- 
			   HAPI stylesheet comes after because it overwrites the Syntax Highlighter
			   font size
			 -->
			<link rel="shortcut icon" href="http://hapifhir.io/favicon.png" />
			<link rel="stylesheet" type="text/css" href="hapi.css" />
        </head> <!-- end : head -->
<body class="page-doc_rest_operations project-hapi-fhir   scroll-top-smooth-enabled m-toc-sidebar-enabled m-toc-sidebar-expanded m-toc-sidebar-autoexpandable toc-sidebar-fixed">
    <nav id="m-top-navbar" class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary border-bottom">
        <div class="container">
                                <a class="navbar-brand mb-0 h1" href="http://hapifhir.io"><span class="color-highlight">HAPI</span> FHIR</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#top-navbar-collapse-1" aria-controls="top-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="top-navbar-collapse-1">
                <ul class="nav navbar-nav ml-auto">
<li class="nav-item " ><a     
     href="https://smilecdr.com"  title="Support"   class="externalLink nav-link" >Support</a></li>
<li class="nav-item " ><a     
     href="download.html"  title="Download"  class="nav-link" >Download</a></li>
<li class="nav-item " ><a     
     href="https://github.com/jamesagnew/hapi-fhir"  title="GitHub Project"   class="externalLink nav-link" >GitHub Project</a></li>
                            <li class="nav-item dropdown active">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Documentation <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="docindex.html" title="Documentation Index"  class="dropdown-item ">Documentation Index</a>
                    <a href="doc_intro.html" title="Introduction"  class="dropdown-item ">Introduction</a>
                    <a href="doc_dstu2.html" title="DSTU3 Support / HL7.org Structures"  class="dropdown-item ">DSTU3 Support / HL7.org Structures</a>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_fhirobjects.html"  title="The Data Model"  class="dropdown-item" >The Data Model</a>                        <div class="dropdown-menu">
                                <a href="doc_fhirobjects.html" title="Working with Resources"  class="dropdown-item ">Working with Resources</a>
                                <a href="doc_resource_references.html" title="Resource References"  class="dropdown-item ">Resource References</a>
                                <a href="doc_extensions.html" title="Profiles & Extensions"  class="dropdown-item ">Profiles & Extensions</a>
                                <a href="doc_tags.html" title="Tags"  class="dropdown-item ">Tags</a>
                                <a href="doc_validation.html" title="Validation"  class="dropdown-item ">Validation</a>
                                <a href="doc_custom_structures.html" title="Custom Structures"  class="dropdown-item ">Custom Structures</a>
                                <a href="doc_converter.html" title="Version Converter"  class="dropdown-item ">Version Converter</a>
                            </div>
                    </div>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_rest_client.html"  title="RESTful Client"  class="dropdown-item" >RESTful Client</a>                        <div class="dropdown-menu">
                                <a href="doc_rest_client.html" title="Fluent/Generic Client"  class="dropdown-item ">Fluent/Generic Client</a>
                                <a href="doc_rest_client_annotation.html" title="Annotation Client"  class="dropdown-item ">Annotation Client</a>
                                <a href="doc_rest_client_interceptor.html" title="Interceptors (client)"  class="dropdown-item ">Interceptors (client)</a>
                                <a href="doc_rest_client_http_config.html" title="Client Configuration"  class="dropdown-item ">Client Configuration</a>
                                <a href="doc_rest_client_examples.html" title="Client Examples"  class="dropdown-item ">Client Examples</a>
                                <a href="doc_rest_client_alternate_provider.html" title="JAX-RS Client & Alternate HTTP Providers"  class="dropdown-item ">JAX-RS Client & Alternate HTTP Providers</a>
                            </div>
                    </div>
                    <div class="dropdown-submenu ">
    <a     
     href="doc_rest_server.html"  title="RESTful Server"  class="dropdown-item" >RESTful Server</a>                        <div class="dropdown-menu">
                                <a href="doc_rest_server.html" title="Using RESTful Server"  class="dropdown-item ">Using RESTful Server</a>
                                                <a href="" title="RESTful Operations"  class="dropdown-item active">RESTful Operations</a>
                                <a href="doc_narrative.html" title="Narrative Generator"  class="dropdown-item ">Narrative Generator</a>
                                <a href="doc_rest_server_interceptor.html" title="Interceptors (server)"  class="dropdown-item ">Interceptors (server)</a>
                                <a href="doc_rest_server_security.html" title="Security"  class="dropdown-item ">Security</a>
                                <a href="doc_cors.html" title="CORS Support"  class="dropdown-item ">CORS Support</a>
                                <a href="doc_server_tester.html" title="Web Testing UI"  class="dropdown-item ">Web Testing UI</a>
                                <a href="doc_rest_server_jaxrs.html" title="JAX-RS Support"  class="dropdown-item ">JAX-RS Support</a>
                            </div>
                    </div>
                    <a href="doc_logging.html" title="Logging"  class="dropdown-item ">Logging</a>
                    <a href="doc_rest_etag.html" title="ETags"  class="dropdown-item ">ETags</a>
                    <a href="doc_jpa.html" title="JPA/Database Server"  class="dropdown-item ">JPA/Database Server</a>
                    <a href="doc_android.html" title="Android Support"  class="dropdown-item ">Android Support</a>
                    <div class="dropdown-submenu ">
    <a     
     href="apidocs/index.html"  title="JavaDocs"  class="dropdown-item" >JavaDocs</a>                        <div class="dropdown-menu">
                                <a href="apidocs/index.html" title="Core API"  class="dropdown-item ">Core API</a>
                                <a href="apidocs-dstu2/index.html" title="Model API (DSTU2)"  class="dropdown-item ">Model API (DSTU2)</a>
                                <a href="apidocs-dstu3/index.html" title="Model API (DSTU3)"  class="dropdown-item ">Model API (DSTU3)</a>
                                <a href="apidocs-r4/index.html" title="Model API (R4)"  class="dropdown-item ">Model API (R4)</a>
                                <a href="apidocs-client/index.html" title="Client API"  class="dropdown-item ">Client API</a>
                                <a href="apidocs-server/index.html" title="Server API (Plain)"  class="dropdown-item ">Server API (Plain)</a>
                                <a href="apidocs-jpaserver/index.html" title="Server API (JPA)"  class="dropdown-item ">Server API (JPA)</a>
                            </div>
                    </div>
                    <a href="doc_cli.html" title="Command Line Tool (hapi-fhir-cli)"  class="dropdown-item ">Command Line Tool (hapi-fhir-cli)</a>
                    <a href="doc_tinder.html" title="Maven Plugin (hapi-tinder-plugin)"  class="dropdown-item ">Maven Plugin (hapi-tinder-plugin)</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Get Help <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="https://github.com/jamesagnew/hapi-fhir/wiki/Getting-Help" title="How to Ask for Help (read this first!)"  class="dropdown-item ">How to Ask for Help (read this first!)</a>
                    <a href="https://groups.google.com/d/forum/hapi-fhir" title="Google Group (Ask Questions)"  class="dropdown-item ">Google Group (Ask Questions)</a>
                    <a href="https://github.com/jamesagnew/hapi-fhir/issues" title="Issue Tracker (Report Bugs/Request Features)"  class="dropdown-item ">Issue Tracker (Report Bugs/Request Features)</a>
                    <a href="https://chat.fhir.org" title="FHIR.org Chat (Live Chat with FHIR Implementors)"  class="dropdown-item ">FHIR.org Chat (Live Chat with FHIR Implementors)</a>
                    <a href="hapi-fhir-faq.html" title="Frequently Asked Questions (FAQ)"  class="dropdown-item ">Frequently Asked Questions (FAQ)</a>
                </div>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Test Server <b class="caret"></b></a>
                <div class="dropdown-menu">
                    <a href="http://hapi.fhir.org" title="Public Test Server"  class="dropdown-item ">Public Test Server</a>
                </div>
            </li>
                </ul><!--/ul.navbar-nav -->
            </div><!--/.nav-collapse -->
        </div> <!--/.container -->
    </nav> <!--/.navbar -->
    <div class="main-body container-fuild my-3">
    <div class="row m-0">
        <div class="d-xs-none d-sm-none d-md-none d-lg-block col-lg-2">
        </div>
        <main class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-8" role="main">
            <div class="header container-fluid">
                                     <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a     
     href="index.html"  title="HAPI FHIR"  class="" >HAPI FHIR</a></li>
            <li class="breadcrumb-item active">RESTful Operations</li>

        </ol>
    </nav>
            </div> <!-- end : header -->
                             <div class="section"> 
 <div class="page-header">
  <h2 id="_toc_operations">Operations</h2>
 </div> 
 <a name="operations"></a> 
 <p> This page shows the operations which can be implemented on HAPI <a href="./doc_rest_server.html">RESTful Servers</a>, as well as <a href="./doc_rest_client_annotation.html">Annotation Clients</a>. Most of the examples shown here show how to implement a server method, but to perform an equivalent call on an annotation client you simply put a method with the same signature in your client interface. </p> 
 <a name="instance_read"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_instance_level_-_read">Instance Level - Read</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#read"> <b>read</b> </a> operation retrieves a resource by ID. It is annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/Read.html">@Read</a> annotation, and has a single parameter annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/IdParam.html">@IdParam</a> annotation. </p> 
 <div class="source"> 
  <pre>@Read()
public Patient getResourceById(@IdParam IdType theId) {
   Patient retVal = new Patient();
   
   // ...populate...
   retVal.addIdentifier().setSystem("urn:mrns").setValue("12345");
   retVal.addName().setFamily("Smith").addGiven("Tester").addGiven("Q");
   // ...etc...
   
   // if you know the version ID of the resource, you should set it and HAPI will 
   // include it in a Content-Location header
   retVal.setId(new IdType("Patient", "123", "2"));
   
   return retVal;
}
</pre> 
 </div> 
 <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient/111</code> </p> 
 <p> The following snippet shows how to define a client interface to handle a read method. </p> 
 <div class="source"> 
  <pre>private interface IPatientClient extends IBasicClient
{
  /** Read a patient from a server by ID */
  @Read
  Patient readPatient(@IdParam IdType theId);

  // Only one method is shown here, but many methods may be 
  // added to the same client interface!
}
</pre> 
 </div> 
 <a name="instance_vread"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_instance_level_-_vread">Instance Level - VRead</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#vread"> <b>vread</b> </a> operation retrieves a specific version of a resource with a given ID. To support vread, simply add "version=true" to your @Read annotation. This means that the read method will support both "Read" and "VRead". The IdDt may or may not have the version populated depending on the client request. </p> 
 <div class="source"> 
  <pre>@Read(version=true)
public Patient readOrVread(@IdParam IdType theId) {
   Patient retVal = new Patient();

   if (theId.hasVersionIdPart()) {
      // this is a vread   
   } else {
      // this is a read
   }

   // ...populate...
   
   return retVal;
}
</pre> 
 </div> 
 <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient/111/_history/2</code> </p> 
 <a name="instance_update"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_instance_level_-_update">Instance Level - Update</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#update"> <b>update</b> </a> operation updates a specific resource instance (using its ID), and optionally accepts a version ID as well (which can be used to detect version conflicts). </p> 
 <p> Update methods must be annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/Update.html">@Update</a> annotation, and have a parameter annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/ResourceParam.html">@ResourceParam</a> annotation. This parameter contains the resource instance to be created. See the <a href="./apidocs/ca/uhn/fhir/rest/annotation/ResourceParam.html">@ResourceParam</a> for information on the types allowed for this parameter (resource types, String, byte[]). </p> 
 <p> In addition, the method may optionally have a parameter annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/IdParam.html">@IdParam</a> annotation, or they may obtain the ID of the resource being updated from the resource itself. Either way, this ID comes from the URL passed in. </p> 
 <p> Update methods must return an object of type <a href="./apidocs/ca/uhn/fhir/rest/api/MethodOutcome.html">MethodOutcome</a> . This object contains the identity of the created resource. </p> 
 <p> The following snippet shows how to define an update method on a server: </p> 
 <div class="source"> 
  <pre>@Update
public MethodOutcome updatePatient(@IdParam IdType theId, @ResourceParam Patient thePatient) {

  /* 
   * First we might want to do business validation. The UnprocessableEntityException
   * results in an HTTP 422, which is appropriate for business rule failure
   */
  if (thePatient.getIdentifierFirstRep().isEmpty()) {
    /* It is also possible to pass an OperationOutcome resource
     * to the UnprocessableEntityException if you want to return
     * a custom populated OperationOutcome. Otherwise, a simple one
     * is created using the string supplied below. 
     */
    throw new UnprocessableEntityException("No identifier supplied");
  }

  String versionId = theId.getVersionIdPart();
  if (versionId != null) {
    // If the client passed in a version number in an If-Match header, they are
    // doing a version-aware update. You may wish to throw an exception if the supplied
    // version is not the latest version. Note that as of DSTU2 the FHIR specification uses
    // ETags and If-Match to handle version aware updates, so PreconditionFailedException (HTTP 412)
    // is used instead of ResourceVersionConflictException (HTTP 409)
    if (detectedVersionConflict) {
      throw new PreconditionFailedException("Unexpected version");
    }
  }
  
  // Save this patient to the database...
  savePatientToDatabase(theId, thePatient);

  // This method returns a MethodOutcome object which contains
  // the ID and Version ID for the newly saved resource
  MethodOutcome retVal = new MethodOutcome();
  String newVersion = "2"; // may be null if the server is not version aware
  retVal.setId(theId.withVersion(newVersion));
  
  // You can also add an OperationOutcome resource to return
  // This part is optional though:
  OperationOutcome outcome = new OperationOutcome();
  outcome.addIssue().setDiagnostics("One minor issue detected");
  retVal.setOperationOutcome(outcome);
  
  // If your server supports creating resources during an update if they don't already exist
  // (this is not mandatory and may not be desirable anyhow) you can flag in the response
  // that this was a creation as follows:
 // retVal.setCreated(true);
  
  return retVal;
}
</pre> 
 </div> 
 <p> Example URL to invoke this method (this would be invoked using an HTTP PUT, with the resource in the PUT body): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient</code> </p> 
 <p> The following snippet shows how the corresponding client interface would look: </p> 
 <div class="source"> 
  <pre>@Update
public abstract MethodOutcome updateSomePatient(@IdParam IdType theId, @ResourceParam Patient thePatient);
</pre> 
 </div> 
 <div class="section"> 
  <div class="section"> 
   <h4 id="_toc_conditional_updates">Conditional Updates</h4> 
   <p> If you wish to suport conditional updates, you can add a parameter tagged with a <a href="./apidocs/ca/uhn/fhir/rest/annotation/ConditionalOperationParam.html">@ConditionalOperationParam</a> annotation. If the request URL contains search parameters instead of a resource ID, then this parameter will be populated. </p> 
   <div class="source"> 
    <pre>@Update
public MethodOutcome updatePatientConditional(
      @ResourceParam Patient thePatient, 
      @IdParam IdType theId, 
      @ConditionalUrlParam String theConditional) {

   // Only one of theId or theConditional will have a value and the other will be null,
   // depending on the URL passed into the server. 
   if (theConditional != null) {
      // Do a conditional update. theConditional will have a value like "Patient?identifier=system%7C00001"
   } else {
      // Do a normal update. theId will have the identity of the resource to update
   }
   
   return new MethodOutcome(); // populate this
}
</pre> 
   </div> 
   <p> Example URL to invoke this method (this would be invoked using an HTTP PUT, with the resource in the PUT body): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?identifier=system%7C00001</code> </p> 
   <a name="raw_update_access"></a> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_accessing_the_raw_resource_payload">Accessing The Raw Resource Payload</h4> 
   <p> If you wish to have access to the raw resource payload as well as the parsed value for any reason, you may also add parameters which have been annotated with the <code class="\&quot;literal\&quot;">@ResourceParam</code> of type <code class="\&quot;literal\&quot;">String</code> (to access the raw resource body) and/or <code class="\&quot;literal\&quot;">EncodingEnum</code> (to determine which encoding was used) </p> 
   <p> The following example shows how to use these additonal data elements. </p> 
   <div class="source"> 
    <pre>@Update
public MethodOutcome updatePatientWithRawValue (
    @ResourceParam Patient thePatient, 
    @IdParam IdType theId, 
    @ResourceParam String theRawBody,
    @ResourceParam EncodingEnum theEncodingEnum) {

   // Here, thePatient will have the parsed patient body, but
   // theRawBody will also have the raw text of the resource 
   // being created, and theEncodingEnum will tell you which
   // encoding was used
 
 return new MethodOutcome(); // populate this
}
</pre> 
   </div> 
   <a name="prefer"></a> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_prefer_header__returning_the_resource_body">Prefer Header / Returning the resource body</h4> 
   <p> If you want to allow clients to request that the server return the resource body as a result of the transaction, you may wish to return the updated resource in the returned MethodOutcome. </p> 
   <p> In this type of request, the client adds a header containing <code class="\&quot;literal\&quot;">Prefer: return=representation</code> which indicates to the server that the client would like the resource returned in the response. </p> 
   <p> In order for the server to be able to honour this request, the server method should add the updated resource to the MethodOutcome object being returned, as shown in the example below. </p> 
   <div class="source"> 
    <pre>@Update
public MethodOutcome updatePatientPrefer(
    @ResourceParam Patient thePatient, 
    @IdParam IdType theId) {

   // Save the patient to the database
   
   // Update the version and last updated time on the resource
   IdType updatedId = theId.withVersion("123");
   thePatient.setId(updatedId);
   InstantType lastUpdated = InstantType.withCurrentTime();
   thePatient.getMeta().setLastUpdatedElement(lastUpdated);
   
   // Add the resource to the outcome, so that it can be returned by the server
   // if the client requests it
   MethodOutcome outcome = new MethodOutcome();
   outcome.setId(updatedId);
   outcome.setResource(thePatient);
   return outcome;
}
</pre> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_contention_aware_updating">Contention Aware Updating</h4> 
   <p> As of FHIR DSTU2, FHIR uses the <code class="\&quot;literal\&quot;">ETag</code> header to provide "conention aware updating". Under this scheme, a client may create a request that contains an ETag specifying the version, and the server will fail if the given version is not the latest version. </p> 
   <p> Such a request is shown below. In the following example, the update will only be applied if resource "Patient/123" is currently at version "3". Otherwise, </p> 
   <div> 
    <pre>PUT [serverBase]/Patient/123
If-Match: W/"3"</pre> 
   </div> 
   <p> If a client performs a contention aware update, the ETag version will be placed in the version part of the IdDt/IdType that is passed into the method. For example: </p> 
   <div class="source"> 
    <pre>@Update
public MethodOutcome update(@IdParam IdType theId, @ResourceParam Patient thePatient) {
   String resourceId = theId.getIdPart();
   String versionId = theId.getVersionIdPart(); // this will contain the ETag
   
   String currentVersion = "1"; // populate this with the current version
   
   if (!versionId.equals(currentVersion)) {
      throw new ResourceVersionConflictException("Expected version " + currentVersion);
   }
   
   // ... perform the update ...
   return new MethodOutcome();
   
}
</pre> 
   </div> 
   <a name="instance_delete"></a> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_instance_level_-_delete">Instance Level - Delete</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#delete"> <b>delete</b> </a> operation retrieves a specific version of a resource with a given ID. It takes a single ID parameter annotated with an <a href="./apidocs/ca/uhn/fhir/rest/annotation/IdParam.html">@IdParam</a> annotation, which supplies the ID of the resource to delete. </p> 
 <div class="source"> 
  <pre>@Delete()
public void deletePatient(@IdParam IdType theId) {
	// .. Delete the patient ..
	if (couldntFindThisId) {
		throw new ResourceNotFoundException("Unknown version");
	}
	if (conflictHappened) {
		throw new ResourceVersionConflictException("Couldn't delete because [foo]");
	}
	// otherwise, delete was successful
	return; // can also return MethodOutcome
}
</pre> 
 </div> 
 <p> Delete methods are allowed to return the following types: </p> 
 <ul> 
  <li> <b>void</b> : This method may return <code class="\&quot;literal\&quot;">void</code> , in which case the server will return an empty response and the client will ignore any successful response from the server (failure responses will still throw an exception) </li> 
  <li> <b> <a href="./apidocs/ca/uhn/fhir/rest/api/MethodOutcome.html">MethodOutcome</a> </b> : This method may return <code class="\&quot;literal\&quot;">MethodOutcome</code> , which is a wrapper for the FHIR OperationOutcome resource, which may optionally be returned by the server according to the FHIR specification. </li> 
 </ul> 
 <p> Example URL to invoke this method (HTTP DELETE): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient/111</code> </p> 
 <div class="section"> 
  <div class="section"> 
   <h4 id="_toc_conditional_deletes">Conditional Deletes</h4> 
   <p> The FHIR specification also allows "conditional deletes". A conditional delete uses a search style URL instead of a read style URL, and deletes a single resource if it matches the given search parameters. The following example shows how to </p> 
   <div class="source"> 
    <pre>@Delete()
public void deletePatientConditional(@IdParam IdType theId, @ConditionalUrlParam String theConditionalUrl) {
   // Only one of theId or theConditionalUrl will have a value depending
   // on whether the URL receieved was a logical ID, or a conditional
   // search string
   if (theId != null) {
      // do a normal delete
   } else {
      // do a conditional delete
   }
   
   // otherwise, delete was successful
   return; // can also return MethodOutcome
}
</pre> 
   </div> 
   <p> Example URL to perform a conditional delete (HTTP DELETE): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?identifier=system%7C0001</code> </p> 
   <a name="type_create"></a> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_type_level_-_create">Type Level - Create</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#create"> <b>create</b> </a> operation saves a new resource to the server, allowing the server to give that resource an ID and version ID. </p> 
 <p> Create methods must be annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/Create.html">@Create</a> annotation, and have a single parameter annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/ResourceParam.html">@ResourceParam</a> annotation. This parameter contains the resource instance to be created. See the <a href="./apidocs/ca/uhn/fhir/rest/annotation/ResourceParam.html">@ResourceParam</a> for information on the types allowed for this parameter (resource types, String, byte[]). </p> 
 <p> Create methods must return an object of type <a href="./apidocs/ca/uhn/fhir/rest/api/MethodOutcome.html">MethodOutcome</a> . This object contains the identity of the created resource. </p> 
 <p> The following snippet shows how to define a server create method: </p> 
 <div class="source"> 
  <pre>@Create
public MethodOutcome createPatient(@ResourceParam Patient thePatient) {

  /* 
   * First we might want to do business validation. The UnprocessableEntityException
   * results in an HTTP 422, which is appropriate for business rule failure
   */
  if (thePatient.getIdentifierFirstRep().isEmpty()) {
    /* It is also possible to pass an OperationOutcome resource
     * to the UnprocessableEntityException if you want to return
     * a custom populated OperationOutcome. Otherwise, a simple one
     * is created using the string supplied below. 
     */
    throw new UnprocessableEntityException("No identifier supplied");
  }
	
  // Save this patient to the database...
  savePatientToDatabase(thePatient);

  // This method returns a MethodOutcome object which contains
  // the ID (composed of the type Patient, the logical ID 3746, and the
  // version ID 1)
  MethodOutcome retVal = new MethodOutcome();
  retVal.setId(new IdType("Patient", "3746", "1"));
  
  // You can also add an OperationOutcome resource to return
  // This part is optional though:
  OperationOutcome outcome = new OperationOutcome();
  outcome.addIssue().setDiagnostics("One minor issue detected");
  retVal.setOperationOutcome(outcome);  
  
  return retVal;
}
</pre> 
 </div> 
 <p> Example URL to invoke this method (this would be invoked using an HTTP POST, with the resource in the POST body): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient</code> </p> 
 <p> The following snippet shows how the corresponding client interface would look: </p> 
 <div class="source"> 
  <pre>@Create
public abstract MethodOutcome createNewPatient(@ResourceParam Patient thePatient);
</pre> 
 </div> 
 <div class="section"> 
  <div class="section"> 
   <h4 id="_toc_conditional_creates">Conditional Creates</h4> 
   <p> The FHIR specification also allows "conditional creates". A conditional create has an additional header called <code class="\&quot;literal\&quot;">If-None-Exist</code> which the client will supply on the HTTP request. The client will populate this header with a search URL such as <code class="\&quot;literal\&quot;">Patient?identifier=foo</code>. See the FHIR specification for details on the semantics for correctly implementing conditional create. </p> 
   <p> When a conditional create is detected (i.e. when the create request contains a populated <code class="\&quot;literal\&quot;">If-None-Exist</code> header), if a method parameter annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/ConditionalOperationParam.html">@ConditionalOperationParam</a> is detected, it will be populated with the value of this header. </p> 
   <div class="source"> 
    <pre>@Create
public MethodOutcome createPatientConditional(
      @ResourceParam Patient thePatient,
      @ConditionalUrlParam String theConditionalUrl) {

   if (theConditionalUrl != null) {
      // We are doing a conditional create

      // populate this with the ID of the existing resource which 
      // matches the conditional URL
      return new MethodOutcome();  
   } else {
      // We are doing a normal create
      
      // populate this with the ID of the newly created resource
      return new MethodOutcome();  
   }
   
}
</pre> 
   </div> 
   <p> Example URL and HTTP header to perform a conditional create: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient<br>If-None-Exist: Patient?identifier=system%7C0001</code> </p> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_prefer_header__returning_the_resource_body1">Prefer Header / Returning the resource body</h4> 
   <p> If you wish to allow your server to honour the <code class="\&quot;literal\&quot;">Prefer</code> header, the same mechanism shown above for <a href="#prefer">Prefer Header for Updates</a> should be used. </p> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_accessing_the_raw_resource_payload1">Accessing The Raw Resource Payload</h4> 
   <p> The create operation also supports access to the raw payload, using the same semantics as raw payload access <a href="#raw_update_access">for the update operation</a>. </p> 
   <a name="type_search"></a> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_type_level_-_search">Type Level - Search</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#search"> <b>search</b> </a> operation returns a bundle with zero-to-many resources of a given type, matching a given set of parameters. </p> 
 <div class="section"> 
  <h3 id="_toc_search_with_no_parameters">Search with No Parameters</h3> 
  <p> The following example shows a search with no parameters. This operation should return all resources of a given type (this obviously doesn't make sense in all contexts, but does for some resource types). </p> 
  <div class="source"> 
   <pre>@Search
public List&lt;Organization&gt; getAllOrganizations() {
   List&lt;Organization&gt; retVal=new ArrayList&lt;Organization&gt;(); // populate this
   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_search_parameters_string_introduction">Search Parameters: String Introduction</h3> 
  <p> To allow a search using given search parameters, add one or more parameters to your search method and tag these parameters as either <a href="./apidocs/ca/uhn/fhir/rest/annotation/RequiredParam.html">@RequiredParam</a> or <a href="./apidocs/ca/uhn/fhir/rest/annotation/OptionalParam.html">@OptionalParam</a> . </p> 
  <p> This annotation takes a "name" parameter which specifies the parameter's name (as it will appear in the search URL). FHIR defines standardized parameter names for each resource, and these are available as constants on the individual HAPI resource classes. </p> 
  <p> Parameters which take a string as their format should use the <code class="\&quot;literal\&quot;"><a href="./apidocs/ca/uhn/fhir/rest/param/StringParam.html">StringParam</a></code> type. They may also use normal java <code class="\&quot;literal\&quot;">String</code>, although it is not possible to use the <code class="\&quot;literal\&quot;">:exact</code> qualifier in that case. </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;Patient&gt; searchByLastName(@RequiredParam(name=Patient.SP_FAMILY) StringParam theFamily) {
   String valueToMatch = theFamily.getValue();
   
   if (theFamily.isExact()) {
	   // Do an exact match search
   } else {
	   // Do a fuzzy search if possible
   }
   
   // ...populate...
   Patient patient = new Patient();
   patient.addIdentifier().setSystem("urn:mrns").setValue("12345");
   patient.addName().setFamily("Smith").addGiven("Tester").addGiven("Q");
   // ...etc...

   //  Every returned resource must have its logical ID set. If the server
   //  supports versioning, that should be set too
   String logicalId = "4325";
   String versionId = "2"; // optional
   patient.setId(new IdType("Patient", logicalId, versionId));
   
   /*
    * This is obviously a fairly contrived example since we are always
    * just returning the same hardcoded patient, but in a real scenario
    * you could return as many resources as you wanted, and they
    * should actually match the given search criteria.
    */
   List&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
   retVal.add(patient);
   
   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?family=SMITH</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_search_parameters_tokenidentifier">Search Parameters: Token/Identifier</h3> 
  <p> The "token" type is used for parameters which have two parts, such as an idnetifier (which has a system URI, as well as the actual identifier) or a code (which has a code system, as well as the actual code). For example, the search below can be used to search by identifier (e.g. search for an MRN). </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;Patient&gt; searchByIdentifier(@RequiredParam(name=Patient.SP_IDENTIFIER) TokenParam theId) {
   String identifierSystem = theId.getSystem();
   String identifier = theId.getValue();
   
   List&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
   // ...populate...
   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?identifier=urn:foo|7000135</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_search_parameters_date_simple">Search Parameters: Date (Simple)</h3> 
  <p> The FHIR specification provides a sytax for specifying dates+times (but for simplicity we will just say dates here) as search criteria. </p> 
  <p> Dates may be optionally prefixed with a qualifier. For example, the string <code class="\&quot;literal\&quot;">&gt;=2011-01-02</code> means any date on or after 2011-01-02. </p> 
  <p> To accept a qualified date parameter, use the DateParam parameter type. </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;Patient&gt; searchByObservationNames( @RequiredParam(name=Patient.SP_BIRTHDATE) DateParam theDate ) {
   ParamPrefixEnum prefix = theDate.getPrefix(); // e.g. gt, le, etc..
   Date date = theDate.getValue(); // e.g. 2011-01-02
   TemporalPrecisionEnum precision = theDate.getPrecision(); // e.g. DAY
	
   List&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
   // ...populate...
   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Observation?birthdate=&gt;=2011-01-02</code> </p> 
  <p> Invoking a client of thie type involves the following syntax: </p> 
  <div class="source"> 
   <pre>DateParam param = new DateParam(ParamPrefixEnum.GREATERTHAN_OR_EQUALS, "2011-01-02");
List&lt;Patient&gt; response = client.getPatientByDob(param);
</pre> 
  </div> 
 </div> 
 <a name="DATE_RANGES"></a> 
 <div class="section"> 
  <h3 id="_toc_search_parameters_date_ranges">Search Parameters: Date (Ranges)</h3> 
  <p> A common scenario in searches is to allow searching for resources with values (i.e timestamps) within a range of dates. </p> 
  <p> FHIR allows for multiple parameters with the same key, and interprets these as being an "AND" set. So, for example, a range of <code class="\&quot;literal\&quot;">date=&gt;=2011-01-01&amp;date=&lt;2011-02-01</code> <br> can be interpreted as any date within January 2011. </p> 
  <p> The following snippet shows how to accept such a range, and combines it with a specific identifier, which is a common scenario. (i.e. Give me a list of observations for a specific patient within a given date range) </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;Observation&gt; searchByDateRange(
    @RequiredParam(name=Observation.SP_DATE) DateRangeParam theRange ) {
  
  Date from = theRange.getLowerBoundAsInstant();
  Date to = theRange.getUpperBoundAsInstant();
	
  List&lt;Observation&gt; retVal = new ArrayList&lt;Observation&gt;();
  // ...populate...
  return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Observation?subject.identifier=7000135&amp;date=&gt;=2011-01-01&amp;date=&lt;2011-02-01</code> </p> 
  <p> Invoking a client of this type involves the following syntax: </p> 
  <div class="source"> 
   <pre>DateParam param = new DateParam(ParamPrefixEnum.GREATERTHAN_OR_EQUALS, "2011-01-02");
List&lt;Patient&gt; response = client.getPatientByDob(param);
</pre> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_unbounded_ranges">Unbounded Ranges</h4> 
   <p> Note that when using a date range parameter, it is also possible for the client to request an "unbounded" range. In other words, a range that only a start date and no end date, or vice versa. </p> 
   <p> An example of this might be the following URL, which refers to any Observation resources for the given MRN and having a date after 2011-01-01. <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Observation?subject.identifier=7000135&amp;date=&gt;=2011-01-01</code> <br> When such a request is made of a server (or to make such a request from a client), the <code class="\&quot;literal\&quot;">getLowerBound()</code> or <code class="\&quot;literal\&quot;">getUpperBound()</code> property of the <code class="\&quot;literal\&quot;">DateRangeParam</code> object will be set to <code class="\&quot;literal\&quot;">null</code> . </p> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_search_parameters_quantity">Search Parameters: Quantity</h3> 
  <p> Quantity parameters allow a number with units and a comparator </p> 
  <p> The following snippet shows how to accept such a range, and combines it with a specific identifier, which is a common scenario. (i.e. Give me a list of observations for a specific patient within a given date range) </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;Observation&gt; getObservationsByQuantity(
        @RequiredParam(name=Observation.SP_VALUE_QUANTITY) QuantityParam theQuantity) {
  
  List&lt;Observation&gt; retVal = new ArrayList&lt;Observation&gt;();
  
  ParamPrefixEnum prefix = theQuantity.getPrefix();
  BigDecimal value = theQuantity.getValue();
  String units = theQuantity.getUnits();
  // .. Apply these parameters ..
  
  // ... populate ...
  return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Observation?value-quantity=&lt;=123.2||mg</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_search_parameters_resource_reference">Search Parameters: Resource Reference</h3> 
  <p> Many search parameters refer to resource references. For instance, the Patient parameter "provider" refers to the resource marked as the managing organization for patients. </p> 
  <p> Reference parameters use the <a href="./apidocs/ca/uhn/fhir/rest/param/ReferenceParam.html">ReferenceParam</a> type. Reference parameters are, in their most basic form, just a pointer to another resource. For example, you might want to query for DiagnosticReport resources where the subject (the Patient resource that the report is about) is Patient/123. The following example shows a simple resource reference parameter in use. </p> 
  <div class="source"> 
   <pre>@Search
public List&lt;DiagnosticReport&gt; findDiagnosticReportsWithSubjet(
		@OptionalParam(name=DiagnosticReport.SP_SUBJECT) ReferenceParam theSubject
		) {
   List&lt;DiagnosticReport&gt; retVal=new ArrayList&lt;DiagnosticReport&gt;();

   // If the parameter passed in includes a resource type (e.g. ?subject:Patient=123)
   // that resource type is available. Here we just check that it is either not provided
   // or set to "Patient"
   if (theSubject.hasResourceType()) {
      String resourceType = theSubject.getResourceType();
      if ("Patient".equals(resourceType) == false) {
         throw new InvalidRequestException("Invalid resource type for parameter 'subject': " + resourceType);
      }
   }
   
   if (theSubject != null) {
      // ReferenceParam extends IdType so all of the resource ID methods are available
      String subjectId = theSubject.getIdPart();
      
      // .. populate retVal with DiagnosticReport resources having 
      // subject with id "subjectId" ..
      
   }
   
   return retVal;

}
</pre> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_chained_resource_references">Chained Resource References</h4> 
   <p> References may also support a "chained" value. This is a search parameter name on the target resource. For example, you might want to search for DiagnosticReport resources by subject, but use the subject's last name instead of their resource ID. In this example, you are chaining "family" (the last name) to "subject" (the patient). The net result in the query string would look like:<br> <code class="\&quot;literal\&quot;">http://fhir.example.com/DiagnosticReport?subject.family=SMITH</code><br> What this query says is "<i>fetch me all of the DiagnosticReport resources where the <b>subject</b> (Patient) of the report has the <b>family</b> (name) of 'SMITH'</i>". </p> 
   <p> There are two ways of dealing with chained parameters in your methods: static chains and dynamic chains. Both are equally valid, although dyamic chains might lead to somewhat more compact and readable code. </p> 
   <a name="dynamic_chains"></a> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_dynamic_chains">Dynamic Chains</h4> 
   <p> Chained values must be explicitly declared through the use of a whitelist (or blacklist). The following example shows how to declare a report with an allowable chained parameter: </p> 
   <div class="source"> 
    <pre>@Search
public List&lt;DiagnosticReport&gt; findReportsWithChain(
    @RequiredParam(name=DiagnosticReport.SP_SUBJECT, chainWhitelist= {Patient.SP_FAMILY, Patient.SP_GENDER}) ReferenceParam theSubject
    ) {
   List&lt;DiagnosticReport&gt; retVal=new ArrayList&lt;DiagnosticReport&gt;();

   String chain = theSubject.getChain();
   if (Patient.SP_FAMILY.equals(chain)) {
      String familyName = theSubject.getValue();
      // .. populate with reports matching subject family name ..
   }
   if (Patient.SP_GENDER.equals(chain)) {
      String gender = theSubject.getValue();
      // .. populate with reports matching subject gender ..
   }

   return retVal;
}
</pre> 
   </div> 
   <p> You may also specify the whitelist value of <code class="\&quot;literal\&quot;">""</code> to allow an empty chain (e.g. ther resource ID) and this can be combined with other values, as shown below: </p> 
   <div class="source"> 
    <pre>@Search
public List&lt;DiagnosticReport&gt; findReportsWithChainCombo (
  @RequiredParam(name=DiagnosticReport.SP_SUBJECT, chainWhitelist= {"", Patient.SP_FAMILY}) ReferenceParam theSubject
  ) {
   List&lt;DiagnosticReport&gt; retVal=new ArrayList&lt;DiagnosticReport&gt;();

   String chain = theSubject.getChain();
   if (Patient.SP_FAMILY.equals(chain)) {
      String familyName = theSubject.getValue();
      // .. populate with reports matching subject family name ..
   }
   if ("".equals(chain)) {
      String resourceId = theSubject.getValue();
      // .. populate with reports matching subject with resource ID ..
   }

   return retVal;
}
</pre> 
   </div> 
   <p> If you are handling multiple types of chained parameters in a single method, you may want to convert the reference parameter type into something more convenient before using its value. The following example shows how to do that. </p> 
   <div class="source"> 
    <pre>@Search()
public List&lt;Observation&gt; findBySubject(
      @RequiredParam(name=Observation.SP_SUBJECT, chainWhitelist = {"", Patient.SP_IDENTIFIER, Patient.SP_BIRTHDATE}) ReferenceParam subject
      ) {
    List&lt;Observation&gt; observations = new ArrayList&lt;Observation&gt;();

    String chain = subject.getChain();
    if (Patient.SP_IDENTIFIER.equals(chain)) {

       // Because the chained parameter "subject.identifier" is actually of type
       // "token", we convert the value to a token before processing it. 
       TokenParam tokenSubject = subject.toTokenParam(myContext);
       String system = tokenSubject.getSystem();
       String identifier = tokenSubject.getValue();
       
       // TODO: populate all the observations for the identifier
       
    } else if (Patient.SP_BIRTHDATE.equals(chain)) {

          // Because the chained parameter "subject.birthdate" is actually of type
          // "date", we convert the value to a date before processing it. 
          DateParam dateSubject = subject.toDateParam(myContext);
          DateTimeType birthDate = new DateTimeType(dateSubject.getValueAsString());
          
          // TODO: populate all the observations for the birthdate
          
    } else if ("".equals(chain)) {
        
       String resourceId = subject.getValue();
        // TODO: populate all the observations for the resource id
        
    }

    return observations;
}
</pre> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_static_chains">Static Chains</h4> 
   <p> It is also possible to explicitly state a chained value right in the parameter name. This is useful if you want to only support a search by a specific given chained parameter. It has the added bonus that you can use the correct parameter type of the chained parameter (in this case a TokenParameter because the Patient.identifier parameter is a token) </p> 
   <div class="source"> 
    <pre>@Search
public List&lt;Patient&gt; findObservations(
		@RequiredParam(name=Observation.SP_SUBJECT+'.'+Patient.SP_IDENTIFIER) TokenParam theProvider
		) {

  String system = theProvider.getSystem();
  String identifier = theProvider.getValue();

  // ...Do a search for all observations for the given subject...
  
  List&lt;Patient&gt; retVal=new ArrayList&lt;Patient&gt;(); // populate this
  return retVal;

}
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_search_parameters_composite">Search Parameters: Composite</h3> 
  <p> Composite search parameters incorporate two parameters in a single value. Each of those parameters will themselves have a parameter type. </p> 
  <p> In the following example, Observation.name-value-date is shown. This parameter is a composite of a string and a date. Note that the composite parameter types (StringParam and DateParam) must be specified in both the annotation's <code class="\&quot;literal\&quot;">compositeTypes</code> field, as well as the generic types for the <code class="\&quot;literal\&quot;">CompositeParam</code> method parameter itself. </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;Observation&gt; searchByComposite(
		@RequiredParam(name=Observation.SP_CODE_VALUE_DATE, compositeTypes= {TokenParam.class, DateParam.class}) 
		CompositeParam&lt;TokenParam, DateParam&gt; theParam) {
  // Each of the two values in the composite param are accessible separately.
  // In the case of Observation's name-value-date, the left is a string and
  // the right is a date.
  TokenParam observationName = theParam.getLeftValue();
  DateParam observationValue = theParam.getRightValue();
	
  List&lt;Observation&gt; retVal = new ArrayList&lt;Observation&gt;();
  // ...populate...
  return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Observation?name-value-date=PROCTIME$2001-02-02</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_combining_multiple_parameters">Combining Multiple Parameters</h3> 
  <p> Search methods may take multiple parameters, and these parameters may (or may not) be optional. To add a second required parameter, annotate the parameter with <a href="./apidocs/ca/uhn/fhir/rest/annotation/RequiredParam.html">@RequiredParam</a> . To add an optional parameter (which will be passed in as <code class="\&quot;literal\&quot;">null</code> if no value is supplied), annotate the method with <a href="./apidocs/ca/uhn/fhir/rest/annotation/OptionalParam.html">@OptionalParam</a> . </p> 
  <p> You may annotate a method with any combination of as many @RequiredParam and as many @OptionalParam parameters as you want. It is valid to have only @RequiredParam parameters, or only @OptionalParam parameters, or any combination of the two. </p> 
  <p> If you wish to create a server that can accept any combination of a large number of parameters, (this is how the various reference servers behave, as well as the <a class="externalLink" href="http://fhirtest.uhn.ca">public HAPI server</a>) the easiest way to accomplish this is to simply create one method with all allowable parameters, each annotated as @OptionalParam. </p> 
  <p> On the other hand, if you have specific combinations of parameters you wish to support (a common scenario if you are building FHIR on top of existing data sources and only have certain indexes you can use) you could create multiple search methods, each with specific required and optional parameters matching the database indexes. </p> 
  <p> The following example shows a method with two parameters. </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;Patient&gt; searchByNames( @RequiredParam(name=Patient.SP_FAMILY) StringParam theFamilyName,
                                    @OptionalParam(name=Patient.SP_GIVEN)  StringParam theGivenName ) {
   String familyName = theFamilyName.getValue();
   String givenName = theGivenName != null ? theGivenName.getValue() : null;
   
   List&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
   // ...populate...
   return retVal;
}
</pre> 
  </div> 
  <p> Example URLs to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?family=SMITH</code> <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?family=SMITH&amp;given=JOHN</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_multi-valued_andor_parameters">Multi-Valued (AND/OR) Parameters</h3> 
  <p> It is possible to accept multiple values of a single parameter as well. This is useful in cases when you want to return a list of resources with criteria matching a list of possible values. See the <a class="externalLink" href="http://www.hl7.org/implement/standards/fhir/search.html#combining">FHIR Specification</a> for more information. </p> 
  <p> The FHIR specification allows two types of composite parameters: </p> 
  <ul> 
   <li> Where a parameter may accept multiple comma separated values within a single value string (e.g. <code class="\&quot;literal\&quot;">?language=FR,NL</code> ) this is treated as an <b>OR</b> relationship, and the search should return elements matching either one or the other. </li> 
   <li> Where a parameter may accept multiple value strings for the same parameter name (e.g. <code class="\&quot;literal\&quot;">?language=FR&amp;language=NL</code> ) this is treated as an <b>AND</b> relationship, and the search should return only elements matching both. </li> 
  </ul> 
  <p> It is worth noting that according to the FHIR specification, you can have an AND relationship combining multiple OR relationships, but not vice-versa. In other words, it's possible to support a search like <code class="\&quot;literal\&quot;">("name" = ("joe" or "john")) AND ("age" = (11 or 12))</code> but not a search like <code class="\&quot;literal\&quot;">("language" = ("en" AND "fr") OR ("address" = ("Canada" AND "Quebec"))</code> </p> 
  <div class="section"> 
   <h4 id="_toc_or_relationship_query_parameters">OR Relationship Query Parameters</h4> 
   <p> To accept a composite parameter, use a parameter type which implements the <a href="./apidocs/ca/uhn/fhir/model/api/IQueryParameterOr.html">IQueryParameterOr</a> interface. </p> 
   <p> Each parameter type (StringParam, TokenParam, etc.) has a corresponding parameter which accepts an OR list of parameters. These types are called "[type]OrListParam", for example: StringOrListParam and TokenOrListParam. </p> 
   <p> The following example shows a search for Observation by name, where a list of names may be passed in (and the expectation is that the server will return Observations that match any of these names): </p> 
   <div class="source"> 
    <pre>@Search()
public List&lt;Observation&gt; searchByObservationNames( 
		@RequiredParam(name=Observation.SP_CODE) TokenOrListParam theCodings ) {

   // The list here will contain 0..* codings, and any observations which match any of the 
   // given codings should be returned
   List&lt;TokenParam&gt; wantedCodings = theCodings.getValuesAsQueryTokens();
   
   List&lt;Observation&gt; retVal = new ArrayList&lt;Observation&gt;();
   // ...populate...
   return retVal;
}
</pre> 
   </div> 
   <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Observation?name=urn:fakenames|123,urn:fakenames|456</code> </p> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_and_relationship_query_parameters">AND Relationship Query Parameters</h4> 
   <p> To accept a composite parameter, use a parameter type which implements the <a href="./apidocs/ca/uhn/fhir/model/api/IQueryParameterAnd.html">IQueryParameterAnd</a> interface (which in turn encapsulates the corresponding IQueryParameterOr types). </p> 
   <p> An example follows which shows a search for Patients by address, where multiple string lists may be supplied by the client. For example, the client might request that the address match <code class="\&quot;literal\&quot;">("Montreal" OR "Sherbrooke") AND ("Quebec" OR "QC")</code> using the following query: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?address=Montreal,Sherbrooke&amp;address=Quebec,QC</code> </p> 
   <p> The following code shows how to receive this parameter using a <a href="./apidocs/ca/uhn/fhir/rest/param/StringAndListParam.html">StringAndListParameter</a>, which can handle an AND list of multiple OR lists of strings. </p> 
   <div class="source"> 
    <pre>@Search()
public List&lt;Patient&gt; searchByPatientAddress( 
		@RequiredParam(name=Patient.SP_ADDRESS) StringAndListParam theAddressParts ) {

  // StringAndListParam is a container for 0..* StringOrListParam, which is in turn a
  // container for 0..* strings. It is a little bit weird to understand at first, but think of the
  // StringAndListParam to be an AND list with multiple OR lists inside it. So you will need 
  // to return results which match at least one string within every OR list. 
  List&lt;StringOrListParam&gt; wantedCodings = theAddressParts.getValuesAsQueryTokens();
  for (StringOrListParam nextOrList : wantedCodings) {
    List&lt;StringParam&gt; queryTokens = nextOrList.getValuesAsQueryTokens();
	// Only return results that match at least one of the tokens in the list below
    for (StringParam nextString : queryTokens) {
    	   // ....check for match...
    }
  }
  
  List&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
  // ...populate...
  return retVal;
}
</pre> 
   </div> 
   <p> Note that AND parameters join multiple OR parameters together, but the inverse is not true. In other words, it is possible in FHIR to use AND search parameters to specify a search criteria of <code class="\&quot;literal\&quot;">(A=1 OR A=2) AND (B=1 OR B=2)</code> but it is not possible to specify <code class="\&quot;literal\&quot;">(A=1 AND B=1) OR (A=2 AND B=2)</code> (aside from in very specific cases where a composite parameter has been specifically defined). </p> 
  </div> 
  <div class="section"> 
   <h4 id="_toc_and_relationship_query_parameters_for_dates">AND Relationship Query Parameters for Dates</h4> 
   <p> Dates are a bit of a special case, since it is a common scenario to want to match a date range (which is really just an AND query on two qualified date parameters). See the section below on <a href="#DATE_RANGES">date ranges</a> for an example of a DateRangeParameter. </p> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_resource_includes__include">Resource Includes (_include)</h3> 
  <p> FHIR allows clients to request that specific linked resources be included as contained resources, which means that they will be "embedded" in a special container called "contained" within the parent resource. </p> 
  <p> HAPI allows you to add a parameter for accepting includes if you wish to support them for specific search methods. </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;DiagnosticReport&gt; getDiagnosticReport( 
               @RequiredParam(name=DiagnosticReport.SP_IDENTIFIER) 
               TokenParam theIdentifier,
               
               @IncludeParam(allow= {"DiagnosticReport:subject"}) 
               Set&lt;Include&gt; theIncludes ) {
	
  List&lt;DiagnosticReport&gt; retVal = new ArrayList&lt;DiagnosticReport&gt;();
 
  // Assume this method exists and loads the report from the DB
  DiagnosticReport report = loadSomeDiagnosticReportFromDatabase(theIdentifier);

  // If the client has asked for the subject to be included:
  if (theIncludes.contains(new Include("DiagnosticReport:subject"))) {
	 
    // The resource reference should contain the ID of the patient
    IIdType subjectId = report.getSubject().getReferenceElement();
	
    // So load the patient ID and return it
    Patient subject = loadSomePatientFromDatabase(subjectId);
    report.getSubject().setResource(subject);
	
  }
 
  retVal.add(report);
  return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/DiagnosticReport?identifier=7000135&amp;_include=DiagnosticReport.subject</code> </p> 
  <p> It is also possible to use a String type for the include parameter, which is more convenient if only a single include (or null for none) is all that is required. </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;DiagnosticReport&gt; getDiagnosticReport( 
             @RequiredParam(name=DiagnosticReport.SP_IDENTIFIER) 
             TokenParam theIdentifier,
             
             @IncludeParam(allow= {"DiagnosticReport:subject"}) 
             String theInclude ) {
	
  List&lt;DiagnosticReport&gt; retVal = new ArrayList&lt;DiagnosticReport&gt;();

  // Assume this method exists and loads the report from the DB
  DiagnosticReport report = loadSomeDiagnosticReportFromDatabase(theIdentifier);

  // If the client has asked for the subject to be included:
  if ("DiagnosticReport:subject".equals(theInclude)) {
	 
    // The resource reference should contain the ID of the patient
    IIdType subjectId = report.getSubject().getReferenceElement();
	
    // So load the patient ID and return it
    Patient subject = loadSomePatientFromDatabase(subjectId);
    report.getSubject().setResource(subject);
	
  }

  retVal.add(report);
  return retVal;
}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_reverse_resource_includes__revinclude">Reverse Resource Includes (_revinclude)</h3> 
  <p> To add support for reverse includes (via the <code class="\&quot;literal\&quot;">_revinclude</code> parameter), use the same format as with the <code class="\&quot;literal\&quot;">_include</code> parameter (shown above) but add <code class="\&quot;literal\&quot;">reverse=true</code> to the <code class="\&quot;literal\&quot;">@IncludeParam</code> annotation, as shown below. </p> 
  <div class="source"> 
   <pre>@Search()
public List&lt;DiagnosticReport&gt; getDiagnosticReport( 
             @RequiredParam(name=DiagnosticReport.SP_IDENTIFIER) 
             TokenParam theIdentifier,
             
             @IncludeParam() 
             Set&lt;Include&gt; theIncludes, 
             
             @IncludeParam(reverse=true)
             Set&lt;Include&gt; theReverseIncludes
         ) {
 
return new ArrayList&lt;DiagnosticReport&gt;(); // populate this
}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_named_queries__query">Named Queries (_query)</h3> 
  <p> FHIR supports <a class="externalLink" href="http://www.hl7.org/implement/standards/fhir/search.html#advanced">named queries</a> , which may have specific behaviour defined. The following example shows how to create a Search operation with a name. </p> 
  <p> This operation can only be invoked by explicitly specifying the given query name in the request URL. Note that the query does not need to take any parameters. </p> 
  <div class="source"> 
   <pre>@Search(queryName="namedQuery1")
public List&lt;Patient&gt; searchByNamedQuery(@RequiredParam(name="someparam") StringParam theSomeParam) {
 List&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
 // ...populate...
 return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?_query=namedQuery1&amp;someparam=value</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_sorting__sort">Sorting (_sort)</h3> 
  <p> FHIR supports <a class="externalLink" href="http://www.hl7.org/implement/standards/fhir/search.html#sort">sorting</a> according to a specific set of rules. </p> 
  <p> According to the specification, sorting is requested by the client using a search param as the sort key. For example, when searching Patient resources, a sort key of "given" requests the "given" search param as the sort key. That param maps to the values in the field "Patient.name.given". </p> 
  <p> Sort specifications can be passed into handler methods by adding a parameter of type SortSpec, which has been annotated with the @Sort annotation, as shown in the following example: </p> 
  <div class="source"> 
   <pre>@Search
public List&lt;Patient&gt; findPatients(
		@RequiredParam(name=Patient.SP_IDENTIFIER) StringParam theParameter,
		@Sort SortSpec theSort) {
   List&lt;Patient&gt; retVal=new ArrayList&lt;Patient&gt;(); // populate this

   // theSort is null unless a _sort parameter is actually provided 
   if (theSort != null) {
      
      // The name of the param to sort by
      String param = theSort.getParamName();

      // The sort order, or null
      SortOrderEnum order = theSort.getOrder();

      // This will be populated if a second _sort was specified
      SortSpec subSort = theSort.getChain();
      
      // ...apply the sort...
   }

   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient?_identifier=urn:foo|123&amp;_sort=given</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_adding_descriptions">Adding Descriptions</h3> 
  <p> It is also possible to annotate search methods and/or parameters with the <a href="./apidocs/ca/uhn/fhir/model/api/annotation/Description.html">@Description</a> annotation. This annotation allows you to add a description of the method and the individual parameters. These descriptions will be placed in the server's conformance statement, which can be helpful to anyone who is developing software against your server. </p> 
  <div class="source"> 
   <pre>@Description(shortDefinition="This search finds all patient resources matching a given name combination")
@Search()
public List&lt;Patient&gt; searchWithDocs( 
          @Description(shortDefinition="This is the patient's last name - Supports partial matches")
          @RequiredParam(name=Patient.SP_FAMILY) StringParam theFamilyName,

          @Description(shortDefinition="This is the patient's given names")
          @OptionalParam(name=Patient.SP_GIVEN)  StringParam theGivenName ) {
	
  List&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
  // ...populate...
  return retVal;
}
</pre> 
  </div> 
 </div> 
 <a name="type_validate"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_type_level_-_validate">Type Level - Validate</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#validate"> <b>validate</b> </a> operation tests whether a resource passes business validation, and would be acceptable for saving to a server (e.g. by a create or update method). </p> 
 <p class="doc_info_bubble"> <b>Note on FHIR versions:</b> In FHIR DSTU1 the validate operation used a URL resembling <code class="\&quot;literal\&quot;">http://example.com/Patient/_validate</code> with a resource in the HTTP POST body. In FHIR DSTU2, validate has been changed to use the <a href="#extended_operations">extended operation</a> mechanism. It now uses a URL resembling <code class="\&quot;literal\&quot;">http://example.com/Patient/$validate</code> and takes a Parameters resource as input in the method body.<br><br> The mechanism described below may be used for both DSTU1 and DSTU2+ servers, and HAPI will automatically use the correct form depending on what FHIR version the server is configured to use. </p> 
 <p> Validate methods must be annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/Validate.html">@Validate</a> annotation, and have a parameter annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/ResourceParam.html">@ResourceParam</a> annotation. This parameter contains the resource instance to be created. </p> 
 <p> Validate methods may optionally also have a parameter oftype IdDt annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/IdParam.html">@IdParam</a> annotation. This parameter contains the resource ID (see the <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#validation">FHIR specification</a> for details on how this is used) </p> 
 <p> Validate methods must return normally if the resource validates successfully, or throw an <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/UnprocessableEntityException.html">UnprocessableEntityException</a> or <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/InvalidRequestException.html">InvalidRequestException</a> if the validation fails. </p> 
 <p> Validate methods must return either: </p> 
 <ul> 
  <li> <b>void</b> - The method should throw an exception for a validation failure, or return normally. </li> 
  <li> An object of type <a href="./apidocs/ca/uhn/fhir/rest/api/MethodOutcome.html">MethodOutcome</a> . The MethodOutcome may optionally be populated with an OperationOutcome resource, which will be returned to the client if it exists. </li> 
 </ul> 
 <p> The following snippet shows how to define a server validate method: </p> 
 <div class="source"> 
  <pre>@Validate
public MethodOutcome validatePatient(@ResourceParam Patient thePatient, 
                                     @Validate.Mode ValidationModeEnum theMode,
                                     @Validate.Profile String theProfile) {

  // Actually do our validation: The UnprocessableEntityException
  // results in an HTTP 422, which is appropriate for business rule failure
  if (thePatient.getIdentifierFirstRep().isEmpty()) {
    /* It is also possible to pass an OperationOutcome resource
     * to the UnprocessableEntityException if you want to return
     * a custom populated OperationOutcome. Otherwise, a simple one
     * is created using the string supplied below. 
     */
    throw new UnprocessableEntityException("No identifier supplied");
  }
	
  // This method returns a MethodOutcome object
  MethodOutcome retVal = new MethodOutcome();

  // You may also add an OperationOutcome resource to return
  // This part is optional though:
  OperationOutcome outcome = new OperationOutcome();
  outcome.addIssue().setSeverity(IssueSeverity.WARNING).setDiagnostics("One minor issue detected");
  retVal.setOperationOutcome(outcome);  

  return retVal;
}
</pre> 
 </div> 
 <p> In the example above, only the <code class="\&quot;literal\&quot;">@ResourceParam</code> parameter is technically required, but in DSTU2 you are encouraged to also add the following parameters: </p> 
 <ul> 
  <li><b>@Validate.Mode ValidationModeEnum mode</b> - This is the validation mode (see the FHIR specification for information on this)</li> 
  <li><b>@Validate.Profile String profile</b> - This is the profile to validate against (see the FHIR specification for more information on this)</li> 
 </ul> 
 <p> Example URL to invoke this method (this would be invoked using an HTTP POST, with a Parameters resource in the POST body): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient/$validate</code> </p> 
 <a name="system_conformance"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_system_level_-_conformance">System Level - Conformance</h2> 
 <p> FHIR defines that a FHIR Server must be able to export a conformance statement, which is an instance of the <a class="externalLink" href="http://hl7.org/implement/standards/fhir/conformance.html">Conformance</a> resource describing the server itself. </p> 
 <p> The HAPI FHIR RESTful server will automatically export such a conformance statement. See the <a href="./doc_rest_server.html">RESTful Server</a> documentation for more information. </p> 
 <p> If you wish to override this default behaviour by creating your own metadata provider, you simply need to define a class with a method annotated using the <a href="./apidocs/ca/uhn/fhir/rest/annotation/Metadata.html">@Metadata</a> annotation. </p> 
 <div class="source"> 
  <pre>public class CapabilityStatementProvider {

  @Metadata
  public CapabilityStatement getServerMetadata() {
	  CapabilityStatement retVal = new CapabilityStatement();
    // ..populate..
    return retVal;
  }

}
</pre> 
 </div> 
 <p> To create a Client which can retrieve a Server's conformance statement is simple. First, define your Client Interface, using the @Metadata annotation: </p> 
 <div class="source"> 
  <pre>public interface MetadataClient extends IRestfulClient {
  
  @Metadata
  CapabilityStatement getServerMetadata();
  
  // ....Other methods can also be added as usual....
  
}
</pre> 
 </div> 
 <p> Then use the standard <a href="doc_rest_client.html">RESTful Client</a> mechanism for instantiating a client: </p> 
 <div class="source"> 
  <pre>FhirContext ctx = FhirContext.forDstu2();
MetadataClient client = ctx.newRestfulClient(MetadataClient.class, "http://spark.furore.com/fhir");
CapabilityStatement metadata = client.getServerMetadata();
System.out.println(ctx.newXmlParser().encodeResourceToString(metadata));
</pre> 
 </div> 
 <a name="system_transaction"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_system_level_-_transaction">System Level - Transaction</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#transaction">transaction</a> action is among the most challenging parts of the FHIR specification to implement. It allows the user to submit a bundle containing a number of resources to be created/updated/deleted as a single atomic transaction. </p> 
 <p> HAPI provides a skeleton for implementing this action, although most of the effort will depend on the underlying implementation. The following example shows how to define a <i>transaction</i> method. </p> 
 <div class="source"> 
  <pre>@Transaction
public Bundle transaction(@TransactionParam Bundle theInput) {
   for (BundleEntryComponent nextEntry : theInput.getEntry()) {
      // Process entry
   }

   Bundle retVal = new Bundle();
   // Populate return bundle
   return retVal;
}
</pre> 
 </div> 
 <p> Transaction methods require one parameter annotated with @TransactionParam, and that parameter may be of type List&lt;IResource&gt; or Bundle. </p> 
 <p> In terms of actually implementing the method, unfortunately there is only so much help HAPI will give you. One might expect HAPI to automatically delegate the individual operations in the transaction to other methods on the server but at this point it does not do that. There is a lot that transaction needs to handle (making everything atomic, replacing placeholder IDs across multiple resources which may even be circular, handling operations in the right order) and so far we have not found a way for the framework to do this in a generic way. </p> 
 <p> What it comes down to is the fact that transaction is a tricky thing to implement. For what it's worth, you could look at our JPA module's "transaction" method in <a class="externalLink" href="https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/dao/dstu3/FhirSystemDaoDstu3.java">our source repository</a> to see how we implemented transaction in the JPA server. </p> 
 <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">POST http://fhir.example.com/</code><br> <i>(note that the content of this POST will be a bundle)</i> </p> 
 <a name="system_search"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_system_level_-_search">System Level - Search</h2> 
 <p> Not yet implemented - Get in touch if you would like to help! </p> 
 <a name="history"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_history_instance_type_server">History (Instance, Type, Server)</h2> 
 <p> The <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#history"> <b>history</b> </a> operation retrieves a historical collection of all versions of a single resource <i>(instance history)</i> , all resources of a given type <i>(type history)</i> , or all resources of any type on a server <i>(server history)</i> . </p> 
 <p> History methods must be annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/History.html">@History</a> annotation, and will have additional requirements depending on the kind of history method intended: </p> 
 <ul> 
  <li> For an <b>Instance History</b> method, the method must have a parameter annotated with the <a href="./apidocs/ca/uhn/fhir/rest/annotation/IdParam.html">@IdParam</a> annotation, indicating the ID of the resource for which to return history. 
   <ul> 
    <li> For a server implementation, the method must either be defined in a <a href="./doc_rest_server.html#resource_providers">resource provider</a> or have a <code class="\&quot;literal\&quot;">type()</code> value in the @History annotation if it is defined in a <a href="./doc_rest_server.html#plain_providers">plain provider</a> . </li> 
   </ul> </li> 
  <li> For a <b>Type History</b> method, the method must not have any @IdParam parameter. 
   <ul> 
    <li> For a server implementation, the method must either be defined in a <a href="./doc_rest_server.html#resource_providers">resource provider</a> or have a <code class="\&quot;literal\&quot;">type()</code> value in the @History annotation if it is defined in a <a href="./doc_rest_server.html#plain_providers">plain provider</a> . </li> 
   </ul> </li> 
  <li> For a <b>Server History</b> method, the method must not have any @IdParam parameter, and must not have a <code class="\&quot;literal\&quot;">type()</code> value specified in the @History annotation. 
   <ul> 
    <li> In a server implementation, the method must be defined in a <a href="./doc_rest_server.html#plain_providers">plain provider</a> . </li> 
   </ul> </li> 
 </ul> 
 <p> The following snippet shows how to define a history method on a server. Note that the following parameters are both optional, but may be useful in implementing the history operation: </p> 
 <u> </u> 
 <li><u> The </u><code class="\&quot;literal\&quot;"><u>@Since</u></code><u> method argument implements the </u><code class="\&quot;literal\&quot;"><u>_since</u></code><u> parameter and should be of type </u><code class="\&quot;literal\&quot;"><u>DateTimeDt</u></code><u> or </u><code class="\&quot;literal\&quot;"><u>DateTimeType</u></code><u> </u></li> 
 <u> </u> 
 <li><u> The </u><code class="\&quot;literal\&quot;"><u>@At</u></code><u> method argument implements the </u><code class="\&quot;literal\&quot;"><u>_at</u></code><u> parameter and may be of type </u><code class="\&quot;literal\&quot;"><u>DateRangeParam</u></code><u>, </u><code class="\&quot;literal\&quot;"><u>DateTimeDt</u></code><u> or </u><code class="\&quot;literal\&quot;"><u>DateTimeType</u></code><u> </u></li> 
 <u> </u> 
 <div class="source"> 
  <pre>@History()
public List&lt;Patient&gt; getPatientHistory(
      @IdParam IdType theId,
      @Since InstantType theSince,
      @At DateRangeParam theAt
      ) {
   List&lt;Patient&gt; retVal = new ArrayList&lt;Patient&gt;();
   
   Patient patient = new Patient();
   patient.addName().setFamily("Smith");
   
   // Set the ID and version
   patient.setId(theId.withVersion("1"));
   
   // ...populate the rest...
   return retVal;
}
</pre> 
 </div> 
 <p> The following snippet shows how to define various history methods in a client. </p> 
 <div class="source"> 
  <pre>public interface HistoryClient extends IBasicClient {
  /** Server level (history of ALL resources) */ 
  @History
  Bundle getHistoryServer();

  /** Type level (history of all resources of a given type) */
  @History(type=Patient.class)
  Bundle getHistoryPatientType();

  /** Instance level (history of a specific resource instance by type and ID) */
  @History(type=Patient.class)
  Bundle getHistoryPatientInstance(@IdParam IdType theId);

  /**
   * Either (or both) of the "since" and "count" paramaters can
   * also be included in any of the methods above.
   */
  @History
  Bundle getHistoryServerWithCriteria(@Since Date theDate, @Count Integer theCount);

}
</pre> 
 </div> 
 <a name="exceptions"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_instance_level_-_patch">Instance Level - Patch</h2> 
 <p> HAPI FHIR includes basic support for the <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#patch"> <b>patch</b> </a> operation. This support allows you to perform patches, but does not include logic to actually implement resource patching in the server framework (note that the JPA server does include a patch implementation). </p> 
 <p> The following snippet shows how to define a patch method on a server: </p> 
 <div class="source"> 
  <pre>	@Patch
	public OperationOutcome patientPatch(@IdParam IdType theId, PatchTypeEnum thePatchType, @ResourceParam String theBody) {

		if (thePatchType == PatchTypeEnum.JSON_PATCH) {
			// do something
		}
		if (thePatchType == PatchTypeEnum.XML_PATCH) {
			// do something
		}
		
		OperationOutcome retVal = new OperationOutcome();
		retVal.getText().setDivAsString("&lt;div&gt;OK&lt;/div&gt;");
		return retVal;
	}
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc_exceptions">Exceptions</h2> 
 <p> When implementing a server operation, there are a number of failure conditions specified. For example, an <a href="#instance_read">Instance Read</a> request might specify an unknown resource ID, or a <a href="#type_create">Type Create</a> request might contain an invalid resource which can not be created. </p> 
 <p> In these cases, an appropriate exception should be thrown. The HAPI RESTful API includes a set of exceptions extending <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/BaseServerResponseException.html">BaseServerResponseException</a> which represent specific HTTP failure codes. </p> 
 <p> See the <a href="./apidocs/ca/uhn/fhir/rest/server/exceptions/package-summary.html">Exceptions List</a> for a complete list of these exceptions. Note that these exceptions are all <b>unchecked</b> exceptions, so they do not need to ne explicitly declared in the method signature. </p> 
 <a name="tags"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_tags">Tags</h2> 
 <p> FHIR RESTful servers may support a feature known as tagging. Tags are a set of named flags called "terms" (with an optional accompanying human friendly name called a "label", and an optional namespace called a "scheme"). </p> 
 <p> Tags have very specific semantics, which may not be obvious simply by using the HAPI API. It is important to review the specification pages <a class="externalLink" href="http://hl7.org/implement/standards/fhir/http.html#tags">here</a> and <a class="externalLink" href="http://hl7.org/implement/standards/fhir/extras.html#tags">here</a> before attempting to implement tagging in your own applications. </p> 
 <div class="section"> 
  <h3 id="_toc_accessing_tags_in_a_read__vread__search_method">Accessing Tags in a Read / VRead / Search Method</h3> 
  <p> Tags are stored within a resource object, in the <a href="./apidocs/ca/uhn/fhir/model/api/IResource.html#getResourceMetadata">IResource.html#getResourceMetadata()</a> map, under the key <a href="./apidocs/ca/uhn/fhir/model/api/ResourceMetadataKeyEnum.html#TAG_LIST">TAG_LIST</a>. </p> 
  <p> In a server implementation, you may populate your tags into the returned resource(s) and HAPI will automatically place these tags into the response headers (for read/vread) or the bundle category tags (for search). The following example illustrates how to return tags from a server method. This example shows how to supply tags in a read method, but the same approach applies to vread and search operations as well. </p> 
  <div class="source"> 
   <pre>@Read()
public Patient readPatient(@IdParam IdType theId) {
  Patient retVal = new Patient();
 
  // ..populate demographics, contact, or anything else you usually would..

  // Populate some tags
  retVal.getMeta().addTag("http://animals", "Dog", "Canine Patient"); // TODO: more realistic example
  retVal.getMeta().addTag("http://personality", "Friendly", "Friendly"); // TODO: more realistic example
  
  return retVal;
}
</pre> 
  </div> 
  <p> In a client operation, you simply call the read/vread/search method as you normally would (as described above), and if any tags have been returned by the server, these may be accessed from the resource metadata. </p> 
  <div class="source"> 
   <pre>IPatientClient client = FhirContext.forDstu2().newRestfulClient(IPatientClient.class, "http://foo/fhir");
Patient patient = client.readPatient(new IdType("1234"));
  
// Access the tag list
List&lt;Coding&gt; tagList = patient.getMeta().getTag();
for (Coding next : tagList) {
  // ..process the tags somehow..
}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_setting_tags_in_a_createupdate_method">Setting Tags in a Create/Update Method</h3> 
  <p> Within a <a href="#type_create">Type Create</a> or <a href="#instance_update">Instance Update</a> method, it is possible for the client to specify a set of tags to be stored along with the saved resource instance. </p> 
  <p> Note that FHIR specifies that in an update method, any tags supplied by the client are copied to the newly saved version, as well as any tags the existing version had. </p> 
  <p> To work with tags in a create/update method, the pattern used in the read examples above is simply revered. In a server, the resource which is passed in will be populated with any tags that the client supplied: </p> 
  <div class="source"> 
   <pre>@Create
public MethodOutcome createPatientResource(@ResourceParam Patient thePatient) {

  // ..save the resouce..
  IdType id = new IdType("123"); // the new databse primary key for this resource

  // Get the tag list
  List&lt;Coding&gt; tags = thePatient.getMeta().getTag();
  for (Coding tag : tags) {
    // process/save each tag somehow	
  }
  
  return new MethodOutcome(id);
}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_more_tag_methods">More tag methods</h3> 
  <p> FHIR also provides a number of operations to interact directly with tags. These methods may be used to retrieve lists of tags that are available on the server, or to add or remove tags from resources without interacting directly with those resources. </p> 
  <p> On a server these methods may be placed in a plain provider, or in a resource provider in the case of resource type specific methods. </p> 
  <div class="source"> 
   <pre>Error during retrieving content skip as ignoreDownloadError activated.</pre> 
  </div> 
  <p> On a client, the methods are defined in the exact same way, except that there is no method body in the client interface. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="_toc__summary_and__elements">_summary and _elements</h2> The 
 <code class="\&quot;literal\&quot;">_summary</code> and 
 <code class="\&quot;literal\&quot;">_elements</code> parameters are automatically handled by the server, so no coding is required to make this work. If you wish to add parameters to manually handle these fields however, the following example shows how to access these. 
 <div class="source"> 
  <pre>@Search
public List&lt;Patient&gt; search(
      SummaryEnum theSummary, // will receive the summary (no annotation required)
      @Elements Set&lt;String&gt; theElements // (requires the @Elements annotation)
      ) {
   return null; // todo: populate
}
</pre> 
 </div> 
 <a name="compartments"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_compartments">Compartments</h2> 
 <p> FHIR defines a mechanism for logically grouping resources together called <a class="externalLink" href="http://www.hl7.org/implement/standards/fhir/extras.html#compartment">compartments</a>. </p> 
 <p> To define a search by compartment, you simply need to add the <code class="\&quot;literal\&quot;">compartmentName</code> attribute to the <code class="\&quot;literal\&quot;">@Search</code> annotation, and add an <code class="\&quot;literal\&quot;">@IdParam</code> parameter. </p> 
 <p> The following example shows a search method in a resource provider which returns a compartment. Note that you may also add <code class="\&quot;literal\&quot;">@RequiredParam</code> and <code class="\&quot;literal\&quot;">@OptionalParam</code> parameters to your compartment search method. </p> 
 <div class="source"> 
  <pre>public class PatientRp implements IResourceProvider {
   
   @Override
   public Class&lt;? extends IBaseResource&gt; getResourceType() {
      return Patient.class;
   }
   
   @Search(compartmentName="Condition")
   public List&lt;IBaseResource&gt; searchCompartment(@IdParam IdType thePatientId) {
      List&lt;IBaseResource&gt; retVal=new ArrayList&lt;IBaseResource&gt;(); 
      
      // populate this with resources of any type that are a part of the
      // "Condition" compartment for the Patient with ID "thePatientId"
      
      return retVal;
   }

   // .. also include other Patient operations ..
}
</pre> 
 </div> 
 <p> Example URL to invoke this method: <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient/123/Condition</code> </p> 
 <a name="extended_operations"></a> 
</div> 
<div class="section"> 
 <h2 id="_toc_extended_operations">Extended Operations</h2> 
 <p> FHIR extended operations are a special type of RPC-style invocation you can perform against a FHIR server, type, or resource instance. These invocations take a <a href="./apidocs-dstu2/ca/uhn/fhir/model/dstu2/resource/Parameters.html">Parameters</a> resource as input, and return either another Parameters resource or a different resource type. </p> 
 <p> To define an operation, a method should be placed in a <a href="./doc_rest_server.html#resource_providers">Resource Provider</a> class if the operation works against a resource type (e.g. <code class="\&quot;literal\&quot;">Patient</code>) or a resource instance (e.g. <code class="\&quot;literal\&quot;">Patient/123</code>), or on a Plain Provider if the operation works against the server (i.e. it is global and not resource specific). </p> 
 <div class="section"> 
  <h3 id="_toc_type-specific_operations">Type-Specific Operations</h3> 
  <p> To implement a type-specific operation, the method should be annotated with the <code class="\&quot;literal\&quot;">@Operation</code> tag, and should have an <code class="\&quot;literal\&quot;">@OperationParam</code> tag for each named parameter that the input Parameters resource may be populated with. The following example shows how to implement the <code class="\&quot;literal\&quot;">Patient/$everything</code> method, defined in the FHIR specification. </p> 
  <div class="source"> 
   <pre>@Operation(name="$everything", idempotent=true)
public Bundle patientTypeOperation(
   @OperationParam(name="start") DateDt theStart,
   @OperationParam(name="end") DateDt theEnd) {
   
   Bundle retVal = new Bundle();
   // Populate bundle with matching resources
   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this operation (HTTP request body is Parameters resource): <br> <code class="\&quot;literal\&quot;">POST http://fhir.example.com/Patient/$everything</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_instance-specific_operations">Instance-Specific Operations</h3> 
  <p> To create an instance-specific operation (an operation which takes the ID of a specific resource instance as a part of its request URL), you can add a parameter annotated with the <code class="\&quot;literal\&quot;">@IdParam</code> annotation, of type <code class="\&quot;literal\&quot;">IdDt</code>. The following example show how to implement the <code class="\&quot;literal\&quot;">Patient/[id]/$everything</code> operation. </p> 
  <div class="source"> 
   <pre>@Operation(name="$everything", idempotent=true)
public Bundle patientInstanceOperation(
   @IdParam IdDt thePatientId,
   @OperationParam(name="start") DateDt theStart,
   @OperationParam(name="end") DateDt theEnd) {
   
   Bundle retVal = new Bundle();
   // Populate bundle with matching resources
   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this operation (HTTP request body is Parameters resource): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/Patient/123/$everything</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_using_search_parameter_types">Using Search Parameter Types</h3> 
  <p> FHIR allows operation parameters to be of a <a class="externalLink" href="http://hl7.org/fhir/search.html#ptypes">Search parameter type</a> (e.g. token) instead of a FHIR datatype (e.g. Coding). </p> 
  <p> To use a search parameter type, any of the search parameter types listed in <a href="./doc_rest_operations.html#Type_Level_-_Search">Search</a> may be used. For example, the following is a simple operation method declaration using search parameters: </p> 
  <div class="source"> 
   <pre>@Operation(name="$find-matches", idempotent=true)
public Parameters findMatchesBasic(
   @OperationParam(name="date") DateParam theDate,
   @OperationParam(name="code") TokenParam theCode) {
   
   Parameters retVal = new Parameters();
   // Populate bundle with matching resources
   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this operation (HTTP request body is Parameters resource): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/$find-matches?date=2011-01-02&amp;code=http://system|value</code> </p> 
  <p> It is also fine to use collection types for search parameter types if you want to be able to accept multiple values. For example, a <code class="\&quot;literal\&quot;">List&lt;TokenParam&gt;</code> could be used if you want to allow multiple repetitions of a given token parameter (this is analogous to the "AND" semantics in a search). A <code class="\&quot;literal\&quot;">TokenOrListParam</code> could be used if you want to allow multiple values within a single repetition, separated by comma (this is analogous to "OR" semantics in a search). </p> 
  <p>For example:</p> 
  <div class="source"> 
   <pre>@Operation(name="$find-matches", idempotent=true)
public Parameters findMatchesAdvanced(
   @OperationParam(name="dateRange") DateRangeParam theDate,
   @OperationParam(name="name") List&lt;StringParam&gt; theName,
   @OperationParam(name="code") TokenAndListParam theEnd) {
   
   Parameters retVal = new Parameters();
   // Populate bundle with matching resources
   return retVal;
}
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_server_operations">Server Operations</h3> 
  <p> Server operations do not operate on a specific resource type or instance, but rather operate globally on the server itself. The following example show how to implement the <code class="\&quot;literal\&quot;">$closure</code> operation. Note that the <code class="\&quot;literal\&quot;">concept</code> parameter in the example has a cardinality of <code class="\&quot;literal\&quot;">0..*</code> according to the FHIR specification, so a <code class="\&quot;literal\&quot;">List&lt;Coding&gt;</code> is used as the parameter type. </p> 
  <div class="source"> 
   <pre>@Operation(name="$closure")
public ConceptMap closureOperation(
   @OperationParam(name="name") StringDt theStart,
   @OperationParam(name="concept") List&lt;CodingDt&gt; theEnd,
   @OperationParam(name="version") IdDt theVersion) {
   
   ConceptMap retVal = new ConceptMap();
   // Populate bundle with matching resources
   return retVal;
}
</pre> 
  </div> 
  <p> Example URL to invoke this operation (HTTP request body is Parameters resource): <br> <code class="\&quot;literal\&quot;">http://fhir.example.com/$closure</code> </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_returning_multiple_out_parameters">Returning Multiple OUT Parameters</h3> 
  <p> In all of the Extended Operation examples above, the return type specified for the operation is a single Resource instance. This is a common pattern in FHIR defined operations. However, it is also possible for an extended operation to be defined with multiple and/or repeating OUT parameters. In this case, you can return a <code class="\&quot;literal\&quot;">Parameters</code> resource directly. </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_idempotent_operations__handling_http_get">Idempotent Operations / Handling HTTP Get</h3> 
  <p> The FHIR specification notes that if an operation is <a class="externalLink" href="http://en.wikipedia.org/wiki/Idempotence">idempotent</a> (which means roughly that it does not modity any data or state on the server) then it may be invoked with an HTTP <code class="\&quot;literal\&quot;">GET</code> instead of an HTTP <code class="\&quot;literal\&quot;">POST</code>. </p> 
  <p> If you are implementing an operation which is idempotent, you should mark your operation with <code class="\&quot;literal\&quot;">idempotent=true</code>, as shown in some of the examples above. The default value for this flag is <code class="\&quot;literal\&quot;">false</code>, meaning that operations will not support <code class="\&quot;literal\&quot;">HTTP GET</code> by default. </p> 
  <p> Note that the HTTP GET form is only supported if the operation has only primitive parameters (no complex parameters or resource parameters). If a client makes a request containing a complex parameter, the server will respond with an <code class="\&quot;literal\&quot;">HTTP 405 Method Not Supported</code>. </p> 
 </div> 
 <div class="section"> 
  <h3 id="_toc_manually_handing_requestresponse">Manually handing Request/Response</h3> 
  <p> For some operations you may wish to bypass the HAPI FHIR standard request parsing and/or response generation. In this case you may use the <code class="\&quot;literal\&quot;">manualRequest()</code> and <code class="\&quot;literal\&quot;">manualResponse()</code> attributes on the <code class="\&quot;literal\&quot;">@Operation</code> annotation. </p> 
  <p> The following example shows an operation that parses the request and generates a response (by echoing back the request). </p> 
  <div class="source"> 
   <pre>	@Operation(name="$manualInputAndOutput", manualResponse=true, manualRequest=true)
	public void manualInputAndOutput(HttpServletRequest theServletRequest, HttpServletResponse theServletResponse) throws IOException {
		String contentType = theServletRequest.getContentType();
		byte[] bytes = IOUtils.toByteArray(theServletRequest.getInputStream());

		ourLog.info("Received call with content type {} and {} bytes", contentType, bytes.length);

		theServletResponse.setContentType(contentType);
		theServletResponse.getOutputStream().write(bytes);
		theServletResponse.getOutputStream().close();
	}
</pre> 
  </div> 
 </div> 
</div>                    </main>
        <div class="d-none d-sm-none d-md-none d-lg-none d-xl-block col-xl-2">
                        <div id="m-toc-sidebar" class="d-print-none m-toc-sidebar-enabled m-toc-sidebar-expanded m-toc-sidebar-autoexpandable toc-sidebar-fixed">
                <nav id="m-toc-sidebar-nav flex-column">
                <ul class="m-nav--sidebar nav flex-column flex-nowrap">
    <li class="h2">
        <a class="nav-link" href="#_toc_operations" title="Operations">Operations</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_instance_level_-_read" title="Instance Level - Read">Instance Level - Read</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_instance_level_-_vread" title="Instance Level - VRead">Instance Level - VRead</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_instance_level_-_update" title="Instance Level - Update">Instance Level - Update</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h4">
        <a class="nav-link" href="#_toc_conditional_updates" title="Conditional Updates">Conditional Updates</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_accessing_the_raw_resource_payload" title="Accessing The Raw Resource Payload">Accessing The Raw Resource Payload</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_prefer_header__returning_the_resource_body" title="Prefer Header / Returning the resource body">Prefer Header / Returning the resource body</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_contention_aware_updating" title="Contention Aware Updating">Contention Aware Updating</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc_instance_level_-_delete" title="Instance Level - Delete">Instance Level - Delete</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h4">
        <a class="nav-link" href="#_toc_conditional_deletes" title="Conditional Deletes">Conditional Deletes</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc_type_level_-_create" title="Type Level - Create">Type Level - Create</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h4">
        <a class="nav-link" href="#_toc_conditional_creates" title="Conditional Creates">Conditional Creates</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_prefer_header__returning_the_resource_body1" title="Prefer Header / Returning the resource body">Prefer Header / Returning the resource body</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_accessing_the_raw_resource_payload1" title="Accessing The Raw Resource Payload">Accessing The Raw Resource Payload</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc_type_level_-_search" title="Type Level - Search">Type Level - Search</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h3">
        <a class="nav-link" href="#_toc_search_with_no_parameters" title="Search with No Parameters">Search with No Parameters</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_search_parameters_string_introduction" title="Search Parameters: String Introduction">Search Parameters: String Introduction</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_search_parameters_tokenidentifier" title="Search Parameters: Token/Identifier">Search Parameters: Token/Identifier</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_search_parameters_date_simple" title="Search Parameters: Date (Simple)">Search Parameters: Date (Simple)</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_search_parameters_date_ranges" title="Search Parameters: Date (Ranges)">Search Parameters: Date (Ranges)</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h4">
        <a class="nav-link" href="#_toc_unbounded_ranges" title="Unbounded Ranges">Unbounded Ranges</a>
    </li>
    </ul>
    <li class="h3">
        <a class="nav-link" href="#_toc_search_parameters_quantity" title="Search Parameters: Quantity">Search Parameters: Quantity</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_search_parameters_resource_reference" title="Search Parameters: Resource Reference">Search Parameters: Resource Reference</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h4">
        <a class="nav-link" href="#_toc_chained_resource_references" title="Chained Resource References">Chained Resource References</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_dynamic_chains" title="Dynamic Chains">Dynamic Chains</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_static_chains" title="Static Chains">Static Chains</a>
    </li>
    </ul>
    <li class="h3">
        <a class="nav-link" href="#_toc_search_parameters_composite" title="Search Parameters: Composite">Search Parameters: Composite</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_combining_multiple_parameters" title="Combining Multiple Parameters">Combining Multiple Parameters</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_multi-valued_andor_parameters" title="Multi-Valued (AND/OR) Parameters">Multi-Valued (AND/OR) Parameters</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h4">
        <a class="nav-link" href="#_toc_or_relationship_query_parameters" title="OR Relationship Query Parameters">OR Relationship Query Parameters</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_and_relationship_query_parameters" title="AND Relationship Query Parameters">AND Relationship Query Parameters</a>
    </li>
    <li class="h4">
        <a class="nav-link" href="#_toc_and_relationship_query_parameters_for_dates" title="AND Relationship Query Parameters for Dates">AND Relationship Query Parameters for Dates</a>
    </li>
    </ul>
    <li class="h3">
        <a class="nav-link" href="#_toc_resource_includes__include" title="Resource Includes (_include)">Resource Includes (_include)</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_reverse_resource_includes__revinclude" title="Reverse Resource Includes (_revinclude)">Reverse Resource Includes (_revinclude)</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_named_queries__query" title="Named Queries (_query)">Named Queries (_query)</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_sorting__sort" title="Sorting (_sort)">Sorting (_sort)</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_adding_descriptions" title="Adding Descriptions">Adding Descriptions</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc_type_level_-_validate" title="Type Level - Validate">Type Level - Validate</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_system_level_-_conformance" title="System Level - Conformance">System Level - Conformance</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_system_level_-_transaction" title="System Level - Transaction">System Level - Transaction</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_system_level_-_search" title="System Level - Search">System Level - Search</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_history_instance_type_server" title="History (Instance, Type, Server)">History (Instance, Type, Server)</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_instance_level_-_patch" title="Instance Level - Patch">Instance Level - Patch</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_exceptions" title="Exceptions">Exceptions</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_tags" title="Tags">Tags</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h3">
        <a class="nav-link" href="#_toc_accessing_tags_in_a_read__vread__search_method" title="Accessing Tags in a Read / VRead / Search Method">Accessing Tags in a Read / VRead / Search Method</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_setting_tags_in_a_createupdate_method" title="Setting Tags in a Create/Update Method">Setting Tags in a Create/Update Method</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_more_tag_methods" title="More tag methods">More tag methods</a>
    </li>
    </ul>
        <li class="h2">
        <a class="nav-link" href="#_toc__summary_and__elements" title="_summary and _elements">_summary and _elements</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_compartments" title="Compartments">Compartments</a>
    </li>
        <li class="h2">
        <a class="nav-link" href="#_toc_extended_operations" title="Extended Operations">Extended Operations</a>
    </li>
    <ul class="nav flex-column flex-nowrap nav-collapsible">
        <li class="h3">
        <a class="nav-link" href="#_toc_type-specific_operations" title="Type-Specific Operations">Type-Specific Operations</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_instance-specific_operations" title="Instance-Specific Operations">Instance-Specific Operations</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_using_search_parameter_types" title="Using Search Parameter Types">Using Search Parameter Types</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_server_operations" title="Server Operations">Server Operations</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_returning_multiple_out_parameters" title="Returning Multiple OUT Parameters">Returning Multiple OUT Parameters</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_idempotent_operations__handling_http_get" title="Idempotent Operations / Handling HTTP Get">Idempotent Operations / Handling HTTP Get</a>
    </li>
    <li class="h3">
        <a class="nav-link" href="#_toc_manually_handing_requestresponse" title="Manually handing Request/Response">Manually handing Request/Response</a>
    </li>
    </ul>
                    </ul>
                </nav>
           </div>
            </div>
    </div> <!-- row: end -->
</div> <!-- .main-body: end -->
    <div id="m-scroll-top" style="display: none;">
        <a href="javascript:;">
            <div class="arrow"></div>
            <div class="stick"></div>
        </a>
    </div>
  <!-- Footer -->
  <footer class="footer-light bg-light">
    <div class="container">
        <div class="row">
        
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">HAPI FHIR                    </li>
                    <li class="nav-item " )><a     
     href="index.html"  title="Home"  class="nav-link" >Home</a></li>
                    <li class="nav-item " )><a     
     href="download.html"  title="Download"  class="nav-link" >Download</a></li>
                    <li class="nav-item " )><a     
     href="changes-report.html"  title="Changelog"  class="nav-link" >Changelog</a></li>
                    <li class="nav-item " )><a     
     href="license.html"  title="License"  class="nav-link" >License</a></li>
                    <li class="nav-header">Test Server                    </li>
                    <li class="nav-item " )><a     
     href="http://hapi.fhir.org"  title="Public Test Server"   class="externalLink nav-link" >Public Test Server</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">Using HAPI                    </li>
                    <li class="nav-item " )><a     
     href="docindex.html"  title="Documentation Index"  class="nav-link" >Documentation Index</a></li>
                    <li class="nav-item " )><a     
     href="doc_cli.html"  title="Command Line Tool (cli)"  class="nav-link" >Command Line Tool (cli)</a></li>
                    <li class="nav-header">Contribute                    </li>
                    <li class="nav-item " )><a     
     href="hacking_hapi_fhir.html"  title="Guide to Hacking HAPI"  class="nav-link" >Guide to Hacking HAPI</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">JavaDocs                    </li>
                    <li class="nav-item " )><a     
     href="apidocs/index.html"  title="Core API"  class="nav-link" >Core API</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu/index.html"  title="Model API (DSTU1)"  class="nav-link" >Model API (DSTU1)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu2/index.html"  title="Model API (DSTU2)"  class="nav-link" >Model API (DSTU2)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-dstu3/index.html"  title="Model API (DSTU3)"  class="nav-link" >Model API (DSTU3)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-r4/index.html"  title="Model API (R4)"  class="nav-link" >Model API (R4)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-client/index.html"  title="Client API"  class="nav-link" >Client API</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-server/index.html"  title="Server API (Plain)"  class="nav-link" >Server API (Plain)</a></li>
                    <li class="nav-item " )><a     
     href="apidocs-jpaserver/index.html"  title="Server API (JPA)"  class="nav-link" >Server API (JPA)</a></li>
                    <li class="nav-header">JXR                    </li>
                    <li class="nav-item " )><a     
     href="xref-base/index.html"  title="Core"  class="nav-link" >Core</a></li>
                    <li class="nav-item " )><a     
     href="xref-jpaserver/index.html"  title="JPA Server"  class="nav-link" >JPA Server</a></li>
                </ul>
            </div>
            <div class="col bottom-nav">

                <ul class="nav flex-column nav-list">
                    <li class="nav-header">Get Help                    </li>
                    <li class="nav-item " )><a     
     href="https://github.com/jamesagnew/hapi-fhir/wiki/Getting-Help"  title="How to Ask for Help (read this first!)"   class="externalLink nav-link" >How to Ask for Help (read this first!)</a></li>
                    <li class="nav-item " )><a     
     href="https://groups.google.com/d/forum/hapi-fhir"  title="Google Group (Ask Questions)"   class="externalLink nav-link" >Google Group (Ask Questions)</a></li>
                    <li class="nav-item " )><a     
     href="https://github.com/jamesagnew/hapi-fhir/issues"  title="Issue Tracker (Report Bugs/Request Features)"   class="externalLink nav-link" >Issue Tracker (Report Bugs/Request Features)</a></li>
                    <li class="nav-item " )><a     
     href="https://chat.fhir.org"  title="FHIR.org Chat (Live Chat with FHIR Implementors)"   class="externalLink nav-link" >FHIR.org Chat (Live Chat with FHIR Implementors)</a></li>
                    <li class="nav-item " )><a     
     href="hapi-fhir-faq.html"  title="Frequently Asked Questions (FAQ)"  class="nav-link" >Frequently Asked Questions (FAQ)</a></li>
                </ul>
            </div>
        <div class="col bottom-description">
            <blockquote class="blockquote">HAPI FHIR is a Java implementation of the HL7 FHIR
				(Fast Healthcare Interoperable Resources) specification.
				This project is open source (licensed under the Apache Software
				License 2.0) and 100% free to use.<br/><br/>
				<a href="https://github.com/jamesagnew/hapi-fhir"><img src="./images/github-logo-mini.png" alt="Hosted on GitHub" border="0"/></a>
				<br/>
				Star us and we will love you!<br />
				<iframe src="https://ghbtns.com/github-btn.html?user=jamesagnew&repo=hapi-fhir&type=star&count=true" frameborder="0" scrolling="0" width="100px" height="20px"></iframe></blockquote>
        </div>
      </div>
    </div>
  </footer>
  <div class="container subfooter">
    <div class="row">
      <div class="col-md-12">
        <p class="copyright">Copyright &copy;2014-2019                 <a href="http://www.uhn.ca">University Health Network</a>
. All Rights Reserved.</p>
        <p class="version-date">
<span class="projectVersion">Version: 4.1.0-SNAPSHOT. </span><span class="publishDate">
    Last Published: 2019-09-04
. </span>        </p>
        <p><a href="https://github.com/devacfr/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://devacfr.github.io" target="_blank" title="devacfr">devacfr</a>.</p>
      </div>
    </div>
  </div>

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/${popperVersion}/umd//popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

  <script src="./js/lightbox.min.js"></script>
      <script src="./js/reflow-skin.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js"></script>
    <script type="text/javascript">
	var elements = document.getElementsByClassName("source");
	for (var i=0; i < elements.length; i++) {
		var pres = elements[i].getElementsByTagName("pre");
		for (var j = 0; j < pres.length; j++) {
			var pre = pres[j];
			if (pre.innerHTML.match(/^\s*\&lt\;/)) {
				pre.className = 'brush: xml';
			} else if (pre.innerHTML.match(/\/\*/)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\/\//)) {
				pre.className = 'brush: java';
			} else if (pre.innerHTML.match(/^\{/)) {
				pre.className = 'brush: jscript';
			} else if (pre.innerHTML.match(/^\#/)) {
				pre.className = 'brush: bash';
			} else if (pre.innerHTML.match(/\&lt\;\//)) {
				pre.className = 'brush: xml';
			} else {
				pre.className = 'brush: java';
			}
		}
	}

	SyntaxHighlighter.all();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1395874-5', 'auto');
  ga('require', 'displayfeatures');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>
                </body >
</html>