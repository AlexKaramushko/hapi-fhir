# CQL

## Introduction

Clinical Quality Language (CQL) is a high-level, domain-specific language focused on clinical quality and targeted at measure and decision support artifact authors. HAPI embeds a [CQL engine](https://github.com/DBCG/cql_engine) allowing the evaluation of clinical knowledge artifacts that use CQL to describe their logic.

A more detailed description of CQL is available at the [CQL Specification Implementation Guide](https://cql.hl7.org/)


## Configuration

These settings apply globally to all operations in which CQL is used.

| Key                                                    | Values                                                                                                                                                                                         | Default                                                  | Description                                                                                                                                                                                                                                                                                                              |
|--------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `hapi.fhir.cr.cql.use_embedded_libraries`              | `true` or `false`                                                                                                                                                                              | `true`                                                   | HAPI ships with embedded versions of some commonly used CQL libraries, specifically `FHIRHelpers`. This switch determines whether or not the cql engine will use those embedded libraries.In the case you want to supply your our version of `FHIRHelpers`, you should set this to false                                 |
| `hapi.fhir.cr.cql.runtime.debug_logging_enabled`       | `true` or `false`                                                                                                                                                                              | `false`                                                  | Enabling debug logging will cause the HAPI server to output detailed evaluation logs for CQL. This can be useful for debug purposes. Debug logging has a significant performance impact.                                                                                                                                 |
| `hapi.fhir.cr.cql.runtime.options`                     | `EnableValidation`, `EnableExpressionCaching`                                                                                                                                                  | `EnableExpressionCaching`                                | This option is a list of flags for the CQL engine. `EnableValidation` checks compiled CQL prior to execution. `EnableExpressionCaching` allows to CQL engine to optimize expression reuse during evaluation, improving performance.                                                                                      |
| `hapi.fhir.cr.cql.compiler.formats`                    | N/A                                                                                                                                                                                            | Set as needed automatically                              | Controls the type of ELM output the CQL compiler produces. Should never need to be set.                                                                                                                                                                                                                                  |
| `hapi.fhir.cr.cql.compiler.options`                    | See the [CQL Compiler](https://github.com/cqframework/clinical_quality_language/blob/master/Src/java/cql-to-elm/OVERVIEW.md#cqltranslatoroptions) documentation for the set of flags supported | Not set, uses compiler defaults                          | These are flags that control the behavior of the CQL compiler                                                                                                                                                                                                                                                            |
| `hapi.fhir.cr.cql.compiler.validate_units`             | `true` or `false`                                                                                                                                                                              | `true`                                                   | This flag controls whether the CQL compiler validates unit quantities for conversion                                                                                                                                                                                                                                     |
| `hapi.fhir.cr.cql.compiler.verify_only`                | `true` or `false`                                                                                                                                                                              | `false`                                                  | This flag controls whether the CQL compiler should emit compiled CQL or simply run semantic analysis. This should never be set to `true`                                                                                                                                                                                 |
| `hapi.fhir.cr.cql.compiler.compatibility_level`        | `1.3` or `1.4` or `1.5`                                                                                                                                                                        | `1.3` if the server is running in DSTU3 mode, otherwise `1.5` | This setting controls the language-level that the CQL compiler should run in. Most DSTU3 content in the wild uses CQL version `1.3`, while newer content uses CQL version `1.5`. If you experience compilation errors with some content you can try setting a different compatibility level to see if they are resolved. |
| `hapi.fhir.cr.cql.compiler.error_level`                | `Info` or `Warning` or `Error`                                                                                                                                                                 | `Info`                                                   | Determines the level of severity required for the CQL compiler to report an issue. `Info` enables all messages, while `Error` enables only `Error` messages.                                                                                                                                                             |
| `hapi.fhir.cr.cql.compiler.signature_level`            | `None` or `Differing` or `Overloads` or `All`                                                                                                                                                   | `None`                                                   | Determines the level of detail to output to compiled CQL for signature resolution. This should generally not be changed.                                                                                                                                                                                                 |
| `hapi.fhir.cr.cql.compiler.analyze_data_requirements`  | `true` or `false`                                                                                                                                                                              | Not set, enabled automatically as needed                 | Determines whether the CQL compiler should do detailed data-requirements analysis when compiling CQL.                                                                                                                                                                                                                    |
| `hapi.fhir.cr.cql.compiler.collapse_data_requirements` | `true` or `false`                                                                                                                                                                              | 'false'                                                  | Determines whether the CQL compiler should "collapse" (i.e. optimize) data-requirements when they are generated.                                                                                                                                                                                                         |

